{{- if .Values.peerpods.enabled }}
{{- if .Values.peerpods.sshKey.publicKeyPath }}
apiVersion: v1
kind: Secret
metadata:
  name: ssh-key-secret
  namespace: {{ .Release.Namespace }}
  annotations:
    argocd.argoproj.io/sync-wave: "-1"
type: Opaque
data:
  {{- $publicKeyPath := .Values.peerpods.sshKey.publicKeyPath }}
  {{- $publicKeyContent := .Files.Get $publicKeyPath }}
  {{- if $publicKeyContent }}
  id_rsa.pub: {{ $publicKeyContent | b64enc | quote }}
  {{- else }}
  {{- fail (printf "SSH public key file not found at path: %s. Please ensure the file exists in the chart directory or use --set-file to provide it." $publicKeyPath) }}
  {{- end }}
  {{- $privateKeyPath := .Values.peerpods.sshKey.privateKeyPath }}
  {{- if $privateKeyPath }}
  {{- $privateKeyContent := .Files.Get $privateKeyPath }}
  {{- if $privateKeyContent }}
  id_rsa: {{ $privateKeyContent | b64enc | quote }}
  {{- else }}
  {{- fail (printf "SSH private key file not found at path: %s. Please ensure the file exists in the chart directory or use --set-file to provide it." $privateKeyPath) }}
  {{- end }}
  {{- end }}
{{- end }}
{{- end }}
